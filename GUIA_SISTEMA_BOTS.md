# ü§ñ GU√çA COMPLETA DEL SISTEMA DE BOTS CON GEMINI API

## ‚úÖ SISTEMA IMPLEMENTADO Y LISTO PARA USAR

---

## üìã √çNDICE

1. [Configuraci√≥n Inicial](#configuraci√≥n-inicial)
2. [C√≥mo Funciona](#c√≥mo-funciona)
3. [Perfiles de Bots](#perfiles-de-bots)
4. [Sistema de Moderaci√≥n](#sistema-de-moderaci√≥n)
5. [Ahorro de Tokens](#ahorro-de-tokens)
6. [Costos Estimados](#costos-estimados)
7. [Soluci√≥n de Problemas](#soluci√≥n-de-problemas)
8. [Preguntas Frecuentes](#preguntas-frecuentes)

---

## üöÄ CONFIGURACI√ìN INICIAL

### Paso 1: Pegar tu API Key de Gemini

1. Abre el archivo `.env` en la ra√≠z del proyecto
2. Busca la l√≠nea que dice:
   ```
   VITE_GEMINI_API_KEY=TU_API_KEY_AQUI
   ```
3. Reemplaza `TU_API_KEY_AQUI` con tu API key real de Gemini
4. Guarda el archivo

**Ejemplo:**
```env
VITE_GEMINI_API_KEY=AIzaSyDXXXXXXXXXXXXXXXXXXXXXXXXXXX
```

### Paso 2: Reiniciar el servidor de desarrollo

```bash
npm run dev
```

### ¬°Listo! üéâ

El sistema de bots est√° completamente integrado y funcionar√° autom√°ticamente.

---

## üéØ C√ìMO FUNCIONA

### Activaci√≥n Autom√°tica

El sistema se activa **SOLO** cuando hay usuarios reales en la sala. Esto ahorra tokens.

| Usuarios Reales | Bots Activos | Intervalo de Mensajes |
|-----------------|--------------|----------------------|
| 0               | 0 bots       | ‚ùå Desactivado        |
| 1               | 3 bots       | Cada 20-40 segundos  |
| 2               | 3 bots       | Cada 30-50 segundos  |
| 3               | 2 bots       | Cada 40-60 segundos  |
| 4               | 2 bots       | Cada 50-70 segundos  |
| 5               | 1 bot        | Cada 60-90 segundos  |
| 6               | 1 bot        | Cada 70-100 segundos |
| 7+              | 0 bots       | ‚úÖ Desactivado        |

### Flujo de Funcionamiento

1. **Usuario entra a una sala vac√≠a**
   - Sistema detecta 1 usuario real
   - Activa 3 bots autom√°ticamente
   - Los bots comienzan a conversar entre ellos

2. **Bots saludan al usuario**
   - Probabilidad del 50% de que un bot d√© la bienvenida
   - Mensajes naturales: "Hola!", "¬øQu√© tal?", "Buenas!"

3. **Usuario escribe un mensaje**
   - Probabilidad del 40% de que un bot responda
   - Delay aleatorio de 8-20 segundos (simula escritura)
   - Respuesta coherente usando Gemini API

4. **Entran m√°s usuarios**
   - Sistema reduce gradualmente el n√∫mero de bots
   - Bots se despiden sutilmente
   - Con 7+ usuarios, todos los bots se desactivan

5. **Sala queda vac√≠a**
   - Todos los bots se detienen inmediatamente
   - **0 tokens gastados** mientras no hay nadie

---

## üë• PERFILES DE BOTS (7 Personajes)

### 1. **Carlos** - Activo/Top
- **Edad**: 28 a√±os
- **Personalidad**: Extrovertido, bromista, directo
- **Intereses**: Gym, deportes, fiestas
- **Estilo**: "¬øQu√© tal gente? üòé", "Yo ac√° relajado viendo qu√© sale"

### 2. **Mateo** - Pasivo/Bottom
- **Edad**: 25 a√±os
- **Personalidad**: Dulce, t√≠mido, emp√°tico
- **Intereses**: M√∫sica, arte, series, gatos
- **Estilo**: "Hola! ‚ò∫Ô∏è", "Ay s√≠, me encanta eso", "Qu√© lindo üíï"

### 3. **Alejandro** - Vers√°til
- **Edad**: 32 a√±os
- **Personalidad**: Maduro, ir√≥nico, culto
- **Intereses**: Cine, pol√≠tica LGBT+, libros, vino
- **Estilo**: "Interesante punto de vista", "Depende de c√≥mo lo veas"

### 4. **David** - Activo (expresivo)
- **Edad**: 26 a√±os
- **Personalidad**: Juguet√≥n, coqueto, divertido
- **Intereses**: Moda, Instagram, makeup, drag shows
- **Estilo**: "Holaaaa! ‚ú®", "Ayy s√≠! Me encanta", "Literal! üíÖ"

### 5. **Miguel** - Pasivo
- **Edad**: 30 a√±os
- **Personalidad**: Tranquilo, sincero, c√°lido
- **Intereses**: Cocina, jardiner√≠a, yoga, naturaleza
- **Estilo**: "Qu√© bueno eso üåø", "Me parece bien", "Interesante experiencia"

### 6. **Javier** - Vers√°til
- **Edad**: 24 a√±os
- **Personalidad**: Geek, curioso, gamer
- **Intereses**: Videojuegos, anime, tecnolog√≠a, Marvel
- **Estilo**: "Hola! üéÆ", "Tal cual!", "¬øEnserio? Qu√© cool"

### 7. **Fernando** - Activo
- **Edad**: 29 a√±os
- **Personalidad**: Seguro, carism√°tico, l√≠der
- **Intereses**: Negocios, coches, whisky, viajes
- **Estilo**: "¬øQu√© tal?", "Dale, suena bien", "Exacto"

**Nota**: Los bots son seleccionados aleatoriamente cada vez que se activan.

---

## üõ°Ô∏è SISTEMA DE MODERACI√ìN

### Protecci√≥n Triple Capa

#### 1Ô∏è‚É£ **Filtros de Gemini (Autom√°tico)**
- Configuraci√≥n de seguridad integrada en la API
- Bloquea contenido:
  - Acoso (harassment)
  - Discurso de odio (hate speech)
  - Sexualmente expl√≠cito (explicit sexual)
  - Contenido peligroso (dangerous content)

#### 2Ô∏è‚É£ **Validaci√≥n Anti-IA (Cr√≠tico)**
Si un bot responde con frases como:
- "Como IA..."
- "Soy un bot..."
- "Lo siento, no puedo..."
- "Soy modelo de lenguaje..."

**Acci√≥n autom√°tica:**
- ‚ùå El mensaje NO se env√≠a
- üö® Se registra advertencia cr√≠tica en consola
- üîÑ Se usa respuesta de fallback gen√©rica

**Ejemplo de advertencia:**
```
üö® ADVERTENCIA CR√çTICA DE BOT üö®
Bot: Carlos
Respuesta inapropiada: "Lo siento, como IA no puedo..."
GRAVE: El bot revel√≥ su naturaleza de IA
ACCI√ìN: Esta respuesta NO se enviar√° al chat
NOTA: Esto NO debe pasar. Respeto a los usuarios es prioritario.
```

#### 3Ô∏è‚É£ **Moderaci√≥n de Usuarios**
Palabras prohibidas detectadas:
- Insultos graves: "puto", "maric√≥n", "sidoso"
- Contenido expl√≠cito sexual
- Referencias a drogas
- Cualquier menci√≥n de menores (CR√çTICO)

**Acci√≥n:**
- ‚ö†Ô∏è Mensaje bloqueado
- üì¢ Advertencia mostrada al usuario
- Ejemplo: "‚ö†Ô∏è Usuario, por favor mant√©n un lenguaje respetuoso."

---

## üí∞ AHORRO DE TOKENS

### Optimizaciones Implementadas

1. **Activaci√≥n Solo con Usuarios**
   - Bots OFF cuando sala = 0 usuarios
   - **Gasto = $0** mientras no hay nadie

2. **L√≠mite de Tokens por Mensaje**
   - M√°ximo 60 tokens de salida (~2-3 frases)
   - Evita respuestas largas innecesarias

3. **Historial Limitado**
   - Solo √∫ltimos 10 mensajes como contexto
   - Reduce tokens de entrada significativamente

4. **Desactivaci√≥n Gradual**
   - Con 7+ usuarios reales, todos los bots OFF
   - Usuarios reales ya generan actividad

5. **Modelo Optimizado**
   - Gemini 1.5 Flash (m√°s econ√≥mico)
   - Mismo rendimiento, menor costo

### Comparaci√≥n de Costos

| Modelo | Costo Entrada | Costo Salida | Costo D√≠a* |
|--------|---------------|--------------|-----------|
| Gemini 1.5 Flash | $0.075/1M | $0.30/1M | $0.014 |
| Gemini 1.5 Pro | $3.50/1M | $10.50/1M | $0.65 |

*Estimaci√≥n: 3 bots, 40 mensajes/hora, 24 horas

**Ahorro: 97% usando Flash**

---

## üìä COSTOS ESTIMADOS

### Escenario Real: Sala con Actividad Moderada

**Configuraci√≥n:**
- 2 bots activos promedio
- 20 mensajes/hora por bot
- 8 horas de actividad diaria (16:00 - 00:00)
- Contexto: 10 mensajes (200 tokens entrada)
- Respuesta: 50 tokens salida

**C√°lculo:**
```
Tokens diarios:
- Entrada: 2 bots √ó 20 msg √ó 8h √ó 200 tokens = 64,000 tokens
- Salida: 2 bots √ó 20 msg √ó 8h √ó 50 tokens = 16,000 tokens

Costo diario:
- Entrada: 64,000 √ó $0.075/1M = $0.0048
- Salida: 16,000 √ó $0.30/1M = $0.0048
- TOTAL: $0.0096 (~1 centavo USD/d√≠a)

Costo mensual: ~$0.29 USD
```

### Escenario Alta Actividad (Sala Siempre Llena)

**Configuraci√≥n:**
- 3 bots activos
- 40 mensajes/hora por bot
- 24 horas de actividad

**Costo estimado:**
```
Costo diario: ~$0.042 USD
Costo mensual: ~$1.26 USD
```

### üéâ CONCLUSI√ìN: EXTREMADAMENTE ECON√ìMICO

---

## üîß SOLUCI√ìN DE PROBLEMAS

### Problema: Los bots no aparecen

**Soluci√≥n:**
1. Verifica que hay al menos 1 usuario real en la sala
2. Revisa que la API key est√© configurada correctamente en `.env`
3. Abre la consola del navegador (F12) y busca errores
4. Verifica que no haya errores de autenticaci√≥n de Gemini

### Problema: Error "API Key no configurada"

**Soluci√≥n:**
1. Aseg√∫rate de haber pegado la API key en `.env`
2. Reinicia el servidor (`Ctrl+C` y luego `npm run dev`)
3. Limpia el cach√© del navegador

### Problema: Los bots responden cosas raras

**Soluci√≥n:**
1. Revisa la consola del navegador
2. Si ves advertencias cr√≠ticas de bot, el sistema est√° funcionando correctamente (bloquea respuestas inapropiadas)
3. Las respuestas de fallback son normales y esperadas

### Problema: Demasiados bots activos

**Soluci√≥n:**
- El sistema se ajusta autom√°ticamente seg√∫n usuarios reales
- Si hay 7+ usuarios, los bots se desactivan solos
- Si quieres menos bots, edita `BOT_ACTIVATION_CONFIG` en `src/services/botCoordinator.js`

### Problema: Los bots gastan muchos tokens

**Soluci√≥n:**
1. Reduce el n√∫mero de bots en la configuraci√≥n
2. Aumenta los intervalos de tiempo entre mensajes
3. Verifica que los bots se desactiven cuando no hay usuarios (revisa consola)

---

## ‚ùì PREGUNTAS FRECUENTES

### ¬øLos bots funcionan en todas las salas?

S√≠, el sistema est√° integrado globalmente. Cualquier sala que uses el componente `ChatPage.jsx` tendr√° bots autom√°ticos.

### ¬øPuedo desactivar el sistema de bots?

S√≠, en `src/pages/ChatPage.jsx` l√≠nea 59-64, cambia `true` por `false`:

```javascript
const { botStatus, triggerBotResponse, isActive: botsActive } = useBotSystem(
  roomId,
  roomUsers,
  messages,
  false // ‚Üê Cambiar a false para desactivar
);
```

### ¬øLos bots se cuentan como usuarios reales?

No. El sistema filtra autom√°ticamente:
- Usuarios con `userId` que comienza con `bot_`
- Usuario `system`

Solo usuarios reales cuentan para la activaci√≥n.

### ¬øPuedo a√±adir m√°s bots?

S√≠, edita `src/config/botProfiles.js` y a√±ade un nuevo objeto con:
- `id`: Debe comenzar con `bot_`
- `username`: Nombre del bot
- `personality`: Descripci√≥n de su personalidad
- `systemPrompt`: Instrucciones detalladas para Gemini

### ¬øPuedo cambiar los intervalos de mensajes?

S√≠, edita `BOT_ACTIVATION_CONFIG` en `src/services/botCoordinator.js`:

```javascript
1: { botsCount: 3, intervalMin: 20, intervalMax: 40 }, // ‚Üê Ajusta estos valores
```

### ¬øLos bots pueden revelar que son IA?

**NO**. El sistema tiene protecci√≥n triple:
1. Prompts espec√≠ficos que les proh√≠ben revelarse
2. Validaci√≥n post-generaci√≥n que bloquea frases de IA
3. Sistema de fallback que usa respuestas gen√©ricas

Si un bot intenta revelar su naturaleza, el mensaje NO se env√≠a y se registra una advertencia cr√≠tica.

### ¬øQu√© pasa si Gemini API falla?

El sistema usa respuestas de fallback gen√©ricas:
- "¬øQu√© tal?"
- "Interesante jaja"
- "¬øY ustedes qu√©?"
- "Cu√©ntenme m√°s"
- "¬øDe d√≥nde son?"

El chat nunca se queda sin actividad.

### ¬øPuedo ver cu√°ntos bots est√°n activos?

S√≠, abre la consola del navegador (F12) y busca logs como:
```
‚úÖ 3 bots iniciados en sala conversas-libres
ü§ñ Carlos envi√≥: "¬øQu√© tal gente? üòé"
```

Tambi√©n puedes ver el estado con:
```javascript
console.log(botStatus);
```

---

## üéì PR√ìXIMOS PASOS (Opcional)

Si quieres mejorar el sistema:

1. **A√±adir indicador de "escribiendo..."**
   - Muestra que el bot est√° escribiendo antes de enviar mensaje
   - M√°s realismo visual

2. **Personalizaci√≥n por sala**
   - Bots distintos para salas diferentes
   - Temas espec√≠ficos seg√∫n sala (gym, gaming, etc.)

3. **Horarios de actividad**
   - Bots m√°s activos en horarios pico (20:00 - 02:00)
   - Ya est√° implementado en `getContextualDelay()`

4. **Analytics**
   - Registro de actividad de bots
   - M√©tricas de engagement

---

## üìû SOPORTE

Si tienes problemas:

1. Revisa esta gu√≠a completa
2. Verifica la consola del navegador (F12)
3. Comprueba que la API key est√© bien configurada
4. Reinicia el servidor de desarrollo

---

## ‚úÖ CHECKLIST FINAL

- [ ] API key pegada en `.env`
- [ ] Servidor reiniciado (`npm run dev`)
- [ ] Entrar a una sala con tu usuario
- [ ] Esperar 5-10 segundos
- [ ] Ver aparecer mensajes de bots en el chat
- [ ] Enviar un mensaje y ver respuesta de bot (40% probabilidad)
- [ ] Ver c√≥mo los bots se desactivan gradualmente al entrar m√°s usuarios

---

## üéâ ¬°SISTEMA COMPLETO Y FUNCIONANDO!

Tu aplicaci√≥n ahora tiene un sistema de bots profesional que:
- ‚úÖ Se activa solo cuando hay usuarios (ahorro de tokens)
- ‚úÖ Tiene 7 personalidades distintas y naturales
- ‚úÖ Sistema de moderaci√≥n autom√°tico
- ‚úÖ Protecci√≥n anti-revelaci√≥n de IA
- ‚úÖ Desactivaci√≥n gradual con m√°s usuarios
- ‚úÖ Costo mensual: ~$0.29 - $1.26 USD
- ‚úÖ Completamente integrado con tu chat existente

**¬°Disfruta tu nueva funcionalidad! üöÄ**
